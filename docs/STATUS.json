{
  "metadata": {
    "generated": "2025-12-24",
    "repository": "denlabs",
    "currentPhase": "Phase 3 - Capa de Métricas y Analytics",
    "phaseStatus": "IN_PROGRESS"
  },
  "executiveSummary": {
    "working": [
      "Core user flows: wallet → handle → missions → rewards",
      "Authentication: Reown AppKit + Supabase profiles",
      "Identity verification: Self.xyz with sandbox mode",
      "Rewards: Spray disperser + GoodDollar engagement",
      "Localization: EN/ES via next-intl",
      "Mobile-responsive layouts"
    ],
    "inProgress": [
      "Lab Runs system: mock data, not database-backed",
      "HOWL/HOLD scoring: display works, calculation incomplete",
      "Role-based UI: infrastructure exists, not utilized"
    ],
    "blocked": [
      "Database migrations: schema not versioned",
      "HOWL calculation: no awardHowl() function",
      "Automated tests: only manual testing",
      "8+ placeholder pages: exist but non-functional"
    ]
  },
  "features": {
    "done": {
      "authentication": {
        "walletConnection": {
          "status": "DONE",
          "files": ["src/lib/appkitConfig.ts", "src/providers/AppKitProvider.tsx"],
          "integration": "Reown AppKit 1.5.2 + ethers 6.15.0"
        },
        "userProfiles": {
          "status": "DONE",
          "files": ["src/lib/supabaseAdmin.ts", "src/app/api/profile/route.ts"],
          "integration": "Supabase lab_users table"
        },
        "selfVerification": {
          "status": "DONE",
          "files": ["src/components/SelfAuth.tsx", "src/lib/selfVerification.ts"],
          "integration": "Self.xyz 1.0.8"
        }
      },
      "pages": {
        "landing": {
          "route": "/",
          "file": "src/app/[locale]/page.tsx",
          "status": "DONE"
        },
        "access": {
          "route": "/access",
          "file": "src/app/[locale]/access/page.tsx",
          "status": "DONE",
          "protected": false
        },
        "lab": {
          "route": "/lab",
          "file": "src/app/[locale]/(den)/lab/page.tsx",
          "status": "DONE",
          "protected": true
        },
        "missions": {
          "route": "/missions",
          "file": "src/app/[locale]/(den)/missions/page.tsx",
          "status": "DONE",
          "protected": false
        },
        "spray": {
          "route": "/spray",
          "file": "src/app/[locale]/(den)/spray/page.tsx",
          "status": "DONE",
          "protected": true
        },
        "gooddollar": {
          "route": "/gooddollar",
          "file": "src/app/[locale]/(den)/gooddollar/page.tsx",
          "status": "DONE",
          "protected": false
        },
        "taberna": {
          "route": "/taberna",
          "file": "src/app/[locale]/(den)/taberna/page.tsx",
          "status": "DONE",
          "protected": true
        },
        "settings": {
          "route": "/settings",
          "file": "src/app/[locale]/(den)/settings/page.tsx",
          "status": "DONE",
          "protected": true
        }
      }
    },
    "wip": {
      "labRuns": {
        "status": "WIP",
        "files": ["src/lib/runs.ts", "src/hooks/useMissions.ts"],
        "issue": "Mock data in code, not database-backed",
        "phase": "Phase 3.1"
      },
      "howlScoring": {
        "status": "WIP",
        "files": ["src/hooks/useDenUser.ts", "src/components/den/StatusStrip.tsx"],
        "issue": "Display works, calculation logic incomplete",
        "missing": ["awardHowl() function", "viewer/member multiplier (x1/x3)", "mission rewards"],
        "phase": "Phase 2.3"
      },
      "roleBasedUI": {
        "status": "WIP",
        "files": ["src/lib/userProfile.ts", "src/hooks/useDenUser.ts"],
        "issue": "Infrastructure exists but not utilized",
        "missing": ["Different nav for organizers", "Run Dashboard", "Sponsor permissions"],
        "phase": "Phase 4.3"
      }
    },
    "planned": [
      {
        "name": "Run Dashboard",
        "phase": "Phase 4.3",
        "description": "Operator view for managing Runs"
      },
      {
        "name": "Merkle Claim Rewards",
        "phase": "Phase 3.3",
        "description": "Spray integration for Run rewards"
      },
      {
        "name": "Event Check-in Contract",
        "phase": "Phase 5.1",
        "description": "Onchain attendance verification"
      },
      {
        "name": "x402 Premium Layer",
        "phase": "Phase 6",
        "description": "HTTP 402 paywalls for metrics"
      },
      {
        "name": "Data Union",
        "phase": "Phase 6.3",
        "description": "Builder data monetization"
      }
    ],
    "placeholder": [
      {
        "route": "/quests",
        "file": "src/app/[locale]/(den)/quests/page.tsx",
        "recommendation": "Remove or clarify vs /missions"
      },
      {
        "route": "/checkin",
        "file": "src/app/[locale]/(den)/checkin/page.tsx",
        "recommendation": "Hide until Phase 5.1"
      },
      {
        "route": "/mentorship",
        "file": "src/app/[locale]/(den)/mentorship/page.tsx",
        "recommendation": "Merge into /taberna or remove"
      },
      {
        "route": "/showcase",
        "file": "src/app/[locale]/(den)/showcase/page.tsx",
        "recommendation": "Hide until sponsors onboarded"
      },
      {
        "route": "/voting",
        "file": "src/app/[locale]/(den)/voting/page.tsx",
        "recommendation": "Hide until voting implemented"
      },
      {
        "route": "/stats",
        "file": "src/app/[locale]/(den)/stats/page.tsx",
        "recommendation": "Hide until Phase 3 complete"
      },
      {
        "route": "/leaderboard",
        "file": "src/app/[locale]/(den)/leaderboard/page.tsx",
        "recommendation": "Hide until HOWL calculation done"
      },
      {
        "route": "/mind-games",
        "file": "src/app/[locale]/(den)/mind-games/page.tsx",
        "recommendation": "Hide or implement"
      }
    ]
  },
  "routes": {
    "main": [
      {
        "path": "/",
        "purpose": "Landing page",
        "protected": false,
        "status": "DONE"
      },
      {
        "path": "/access",
        "purpose": "Wallet + handle + Self onboarding",
        "protected": false,
        "status": "DONE"
      }
    ],
    "den": [
      {
        "path": "/lab",
        "purpose": "Builder home/profile",
        "protected": "requireProfile",
        "status": "DONE"
      },
      {
        "path": "/missions",
        "purpose": "Mission grid",
        "protected": "gates missions",
        "status": "DONE"
      },
      {
        "path": "/auth",
        "purpose": "Self.xyz verification",
        "protected": false,
        "status": "DONE"
      },
      {
        "path": "/spray",
        "purpose": "Bulk token disperser",
        "protected": "requireWallet",
        "status": "DONE"
      },
      {
        "path": "/gooddollar",
        "purpose": "GoodDollar rewards",
        "protected": "requires wallet+Self",
        "status": "DONE"
      },
      {
        "path": "/taberna",
        "purpose": "Live mentorship rooms",
        "protected": "requireWallet",
        "status": "DONE"
      },
      {
        "path": "/settings",
        "purpose": "User preferences",
        "protected": "requireWallet",
        "status": "DONE"
      },
      {
        "path": "/quests",
        "purpose": "Quest list",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/checkin",
        "purpose": "Event check-in",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/mentorship",
        "purpose": "Mentor booking",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/showcase",
        "purpose": "Sponsor showcase",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/voting",
        "purpose": "Demo Day voting",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/stats",
        "purpose": "Analytics/insights",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/leaderboard",
        "purpose": "HOWL rankings",
        "protected": false,
        "status": "PLACEHOLDER"
      },
      {
        "path": "/mind-games",
        "purpose": "Mini-games",
        "protected": false,
        "status": "PLACEHOLDER"
      }
    ],
    "api": [
      {
        "endpoint": "/api/auth/wallet-login",
        "method": "POST",
        "purpose": "Create/retrieve profile + session",
        "status": "DONE"
      },
      {
        "endpoint": "/api/auth/session",
        "method": "GET",
        "purpose": "Fetch current session",
        "status": "DONE"
      },
      {
        "endpoint": "/api/profile",
        "method": "GET/POST",
        "purpose": "Retrieve/update profile",
        "status": "DONE"
      },
      {
        "endpoint": "/api/trust/self-verify",
        "method": "POST",
        "purpose": "Mark Self-verified + HOWL boost",
        "status": "DONE"
      },
      {
        "endpoint": "/api/self/verify",
        "method": "POST",
        "purpose": "Self.xyz callback",
        "status": "DONE"
      },
      {
        "endpoint": "/api/lab-user",
        "method": "GET/POST",
        "purpose": "Legacy user endpoint",
        "status": "DEPRECATED",
        "note": "Migrate to /api/auth"
      },
      {
        "endpoint": "/api/lab-user/wallet",
        "method": "POST",
        "purpose": "Legacy wallet update",
        "status": "DEPRECATED",
        "note": "Migrate to /api/profile"
      },
      {
        "endpoint": "/api/lab-user/self",
        "method": "POST",
        "purpose": "Legacy Self update",
        "status": "DEPRECATED",
        "note": "Migrate to /api/trust"
      }
    ]
  },
  "integrations": {
    "reownAppKit": {
      "version": "1.5.2",
      "purpose": "Wallet connection",
      "files": ["src/lib/appkitConfig.ts", "src/providers/AppKitProvider.tsx"],
      "uses": "ethers 6.15.0",
      "status": "INTEGRATED",
      "envVars": ["NEXT_PUBLIC_REOWN_PROJECT_ID", "NEXT_PUBLIC_MAINNET_RPC"]
    },
    "selfXyz": {
      "version": "1.0.8 core, 1.0.11 qrcode",
      "purpose": "Identity verification",
      "files": ["src/components/SelfAuth.tsx", "src/lib/selfEndpoint.ts", "src/lib/selfVerification.ts"],
      "status": "INTEGRATED",
      "envVars": [
        "NEXT_PUBLIC_SELF_APP_NAME",
        "NEXT_PUBLIC_SELF_ENDPOINT",
        "NEXT_PUBLIC_SELF_SCOPE",
        "NEXT_PUBLIC_SELF_DEEPLINK_CALLBACK",
        "NEXT_PUBLIC_SELF_DEV_MODE",
        "SELF_USE_SANDBOX"
      ]
    },
    "supabase": {
      "version": "2.86.2",
      "purpose": "User profiles",
      "files": ["src/lib/supabaseAdmin.ts", "src/lib/userProfile.ts"],
      "table": "lab_users",
      "status": "INTEGRATED",
      "envVars": ["NEXT_PUBLIC_SUPABASE_URL", "SUPABASE_SERVICE_ROLE_KEY"]
    },
    "goodDollar": {
      "version": "1.0.3",
      "purpose": "Engagement rewards",
      "files": ["src/hooks/useGoodDollar.ts", "src/lib/gooddollar.ts", "src/hooks/useGoodDollarInvite.ts"],
      "uses": "Viem 2.41.2",
      "status": "INTEGRATED",
      "envVars": ["NEXT_PUBLIC_GD_REWARDS_CONTRACT", "NEXT_PUBLIC_GD_APP_ADDRESS"]
    },
    "nextIntl": {
      "version": "3.17.0",
      "purpose": "Internationalization",
      "files": ["src/i18n/routing.ts", "src/middleware.ts"],
      "languages": ["en", "es"],
      "status": "INTEGRATED",
      "envVars": []
    },
    "taberna": {
      "purpose": "Live event rooms",
      "status": "MINIMAL",
      "note": "Simple iframe embed",
      "envVars": ["NEXT_PUBLIC_TABERNA_URL"]
    }
  },
  "envVars": {
    "required": {
      "supabase": [
        "NEXT_PUBLIC_SUPABASE_URL",
        "SUPABASE_SERVICE_ROLE_KEY"
      ],
      "wallet": [
        "NEXT_PUBLIC_REOWN_PROJECT_ID"
      ],
      "self": [
        "NEXT_PUBLIC_SELF_APP_NAME",
        "NEXT_PUBLIC_SELF_ENDPOINT",
        "NEXT_PUBLIC_SELF_SCOPE",
        "NEXT_PUBLIC_SELF_DEEPLINK_CALLBACK"
      ],
      "gooddollar": [
        "NEXT_PUBLIC_GD_REWARDS_CONTRACT",
        "NEXT_PUBLIC_GD_APP_ADDRESS"
      ],
      "system": [
        "NEXT_PUBLIC_SITE_URL",
        "NODE_ENV"
      ]
    },
    "optional": {
      "wallet": ["NEXT_PUBLIC_MAINNET_RPC"],
      "self": ["NEXT_PUBLIC_SELF_DEV_MODE", "SELF_USE_SANDBOX"],
      "taberna": ["NEXT_PUBLIC_TABERNA_URL"]
    },
    "missing": {
      "envExample": true,
      "note": "No .env.example file found"
    }
  },
  "database": {
    "provider": "Supabase",
    "version": "2.86.2",
    "tables": {
      "lab_users": {
        "file": "src/lib/userProfile.ts",
        "status": "EXISTS_IN_PROD",
        "schema": {
          "id": "UUID PRIMARY KEY",
          "handle": "VARCHAR(32) UNIQUE",
          "display_name": "VARCHAR(255) NOT NULL",
          "role": "VARCHAR(20) CHECK (role IN ('player', 'organizer', 'sponsor'))",
          "wallet_address": "VARCHAR(42)",
          "self_verified": "BOOLEAN DEFAULT false",
          "hold_score": "INTEGER DEFAULT 0",
          "avatar_url": "TEXT",
          "created_at": "TIMESTAMPTZ DEFAULT NOW()",
          "updated_at": "TIMESTAMPTZ DEFAULT NOW()"
        }
      }
    },
    "mockData": {
      "runs": {
        "file": "src/lib/runs.ts",
        "status": "IN_CODE_NOT_DB",
        "note": "Should migrate to Supabase in Phase 3.1"
      },
      "missions": {
        "file": "src/lib/runs.ts",
        "status": "IN_CODE_NOT_DB",
        "note": "Should migrate to Supabase in Phase 3.1"
      },
      "missionProgress": {
        "file": "src/hooks/useMissions.ts",
        "status": "LOCALSTORAGE_ONLY",
        "note": "Should migrate to DB for multi-device sync"
      }
    },
    "migrations": {
      "status": "MISSING",
      "note": "No migrations/ folder or schema.sql found",
      "recommendation": "Add versioned migration files immediately"
    }
  },
  "commands": {
    "development": {
      "dev": "pnpm run dev",
      "build": "pnpm run build",
      "start": "pnpm run start"
    },
    "codeQuality": {
      "lint": "pnpm run lint",
      "format": "pnpm run format"
    },
    "testing": {
      "installBrowsers": "pnpm run pw:install",
      "runTests": "pnpm run test:routes"
    },
    "preCommit": {
      "required": ["pnpm run lint", "pnpm run format", "pnpm run build"],
      "note": "All must pass before committing"
    }
  },
  "knownIssues": {
    "todos": [
      {
        "file": "src/components/ui/MiniChat.tsx",
        "line": 13,
        "text": "TODO: integrate Farcaster cast/share"
      }
    ],
    "typescript": {
      "tsIgnoreCount": 0,
      "anyTypes": [
        {
          "file": "src/hooks/useGoodDollar.ts",
          "lines": [27, 32],
          "reason": "Viem client type casting for GoodDollar SDK",
          "severity": "acceptable"
        }
      ]
    },
    "console": {
      "debugLogs": [
        {
          "file": "src/components/SelfAuth.tsx",
          "line": 272,
          "text": "console.log('Self verification successful via deeplink!')",
          "action": "REMOVE"
        },
        {
          "file": "src/components/SelfAuth.tsx",
          "line": 287,
          "text": "console.log('Self verification successful!')",
          "action": "REMOVE"
        }
      ],
      "errorLogs": {
        "count": 30,
        "status": "acceptable",
        "note": "All in API routes and component error handlers"
      }
    },
    "architectural": [
      {
        "issue": "Legacy API endpoints",
        "files": ["src/app/api/lab-user/route.ts", "src/app/api/lab-user/wallet/route.ts", "src/app/api/lab-user/self/route.ts"],
        "priority": "P1",
        "recommendation": "Migrate to /api/auth/* and /api/profile"
      },
      {
        "issue": "Mock data not in database",
        "files": ["src/lib/runs.ts", "src/hooks/useMissions.ts"],
        "priority": "P0",
        "recommendation": "Migrate Runs/Missions to Supabase",
        "phase": "Phase 3.1"
      },
      {
        "issue": "No role-based navigation",
        "files": ["src/components/den/SidebarNav.tsx", "src/hooks/useDenUser.ts"],
        "priority": "P1",
        "recommendation": "Build Run Dashboard for operators",
        "phase": "Phase 4.3"
      },
      {
        "issue": "HOWL calculation incomplete",
        "files": ["src/hooks/useDenUser.ts", "src/components/den/StatusStrip.tsx"],
        "priority": "P0",
        "missing": ["awardHowl() function", "viewer/member multiplier", "mission rewards"],
        "phase": "Phase 2.3"
      },
      {
        "issue": "No database migrations",
        "priority": "P0",
        "recommendation": "Add migrations/ folder with versioned SQL"
      },
      {
        "issue": "Placeholder pages in production",
        "count": 8,
        "priority": "P1",
        "recommendation": "Hide behind feature flags or remove"
      }
    ],
    "testing": {
      "unitTests": "MISSING",
      "integrationTests": "MISSING",
      "e2eTests": "MINIMAL",
      "coverage": "~5%",
      "recommendation": "Add tests for critical flows: /access → /lab → /missions"
    }
  },
  "dependencies": {
    "core": {
      "nextjs": "15.5.9",
      "react": "19.1.2",
      "typescript": "5",
      "tailwind": "4",
      "biome": "2.2.0"
    },
    "blockchain": {
      "ethers": "6.15.0",
      "viem": "2.41.2",
      "@reown/appkit": "1.5.2",
      "@goodsdks/engagement-sdk": "1.0.3"
    },
    "identity": {
      "@selfxyz/core": "1.0.8",
      "@selfxyz/qrcode": "1.0.11",
      "@supabase/supabase-js": "2.86.2"
    },
    "ui": {
      "lucide-react": "0.471.0",
      "@radix-ui/react-switch": "1.2.6",
      "next-intl": "3.17.0"
    },
    "testing": {
      "@playwright/test": "1.57.0"
    }
  },
  "documentation": {
    "available": [
      "CLAUDE.md",
      "AGENTS.md",
      "PROJECT_FLOW.md",
      "progress.json",
      "README.md",
      "docs/PRD.md",
      "docs/structure.md",
      "docs/spray-console.md",
      "docs/gooddolar.md",
      "docs/new-profile-lab.md",
      "docs/new-implementation-onboarding.md"
    ],
    "missing": [
      "Database schema file (schema.sql or migrations/)",
      "API documentation (OpenAPI/Swagger)",
      ".env.example template",
      "Testing guide",
      "Deployment/CI-CD guide",
      "Troubleshooting guide"
    ]
  },
  "healthScore": {
    "overall": "FUNCTIONAL_BUT_INCOMPLETE",
    "featureCompletion": {
      "authOnboarding": 95,
      "userProfiles": 90,
      "missions": 70,
      "rewards": 60,
      "integrations": 85,
      "roleBasedUI": 30,
      "analyticsMetrics": 10,
      "tests": 5
    }
  },
  "recommendations": {
    "p0": [
      {
        "action": "Create database migrations",
        "details": "Add migrations/ folder with SQL schema for lab_users, runs, missions"
      },
      {
        "action": "Migrate Runs/Missions to Supabase",
        "details": "Move mock data from src/lib/runs.ts to database",
        "phase": "Phase 3.1"
      },
      {
        "action": "Remove debug console.log statements",
        "files": ["src/components/SelfAuth.tsx"]
      }
    ],
    "p1": [
      {
        "action": "Implement HOWL calculation",
        "details": "Add awardHowl() function with viewer/member multiplier",
        "phase": "Phase 2.3"
      },
      {
        "action": "Hide or complete placeholder pages",
        "count": 8,
        "details": "Use feature flags or remove confusing routes"
      },
      {
        "action": "Consolidate legacy API routes",
        "details": "Migrate /api/lab-user/* to /api/auth/* and /api/profile"
      }
    ],
    "p2": [
      {
        "action": "Add .env.example file",
        "details": "Template with all required variables"
      },
      {
        "action": "Write integration tests",
        "details": "Test /access → /lab → /missions flow"
      },
      {
        "action": "Build Run Dashboard",
        "details": "Operator UI for managing Runs",
        "phase": "Phase 4.3"
      },
      {
        "action": "Implement Merkle Claims",
        "details": "Spray integration for Run rewards",
        "phase": "Phase 3.3"
      }
    ]
  },
  "nextSession": {
    "recommended": "Wire up useDenUser/StatusStrip to persisted Supabase profile and QA the /access → /lab → /spray flow (desktop + mobile)",
    "phase": "Phase 3.1",
    "focus": [
      "Database migration work (P0 #1-2)",
      "Implement basic HOWL calculation (P1 #4)",
      "Hide placeholder pages (P1 #5)"
    ]
  }
}
